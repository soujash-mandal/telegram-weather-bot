<%- include('partials/header') -%>

<h1 class="text-4xl">Welcome to Admin Panel</h1>

<% if (locals.isAuthenticated) { %>

<table>
    <tr>
        <th>Chat ID</th>
        <th>Name</th>
        <th>username</th>
        <th>Last Location</th>
        <th></th>
    </tr>
  <% locals.result.forEach(element => { %>
    <tr>
        <td><%= element.chatId%></td>
        <td><%= element.name%></td>
        <td><%= element.username%></td>
        <td><%= element.location %></td>
        <td>
            <button onclick="blockUser('<%= element.chatId %>')">Block</button>
            <button onclick="deleteUser('<%= element.chatId %>')">Delete</button>
        </td>
        
    </tr>
  <% }); %>
</ul>
<!-- <p>
  You are logged in. <a href="/profile" class="underline">View your profile</a>.
</p> -->
<% } else { %>
<p>You are not logged in. <a href="/login" class="underline">Login</a>.</p>
<% } %> <%- include('partials/footer') -%>

<script>
    function blockUser(chatId) {
    if (confirm('Are you sure you want to block this user?')) {
      // Make an AJAX request to your server to update the blocked status
      fetch('/block-user', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ chatId: chatId }),
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(`User with Chat ID ${chatId} has been blocked.`);
            // Optionally, you can update the UI to reflect the blocked status.
          } else {
            alert('Failed to block user.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while blocking the user.');
        });
    }
  }
    function deleteUser(chatId) {
        if (confirm('Are you sure you want to delete this user?')) {
      // Make an AJAX request to your server to update the deleted status
      fetch('/delete-user', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ chatId: chatId }),
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(`User with Chat ID ${chatId} has been deleted.`);
            // Optionally, you can update the UI to reflect the deleted status.
          } else {
            alert('Failed to delete user.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while deleting the user.');
        });
    }
    }
  </script>
  
